<!DOCTYPE HTML>
<html>
   <head>
      <script type="text/javascript">
         function WebSocketTest()
         {
            counter = 0;

            HELLO = 1;
            SUBSCRIBE = 32;
            PUBLISH = 16;

            if ("WebSocket" in window)
            {
               // Let us open a web socket
               window.ws = new WebSocket("ws://localhost:5000/websocket");

               window.ws.onopen = function()
               {
                  // Web Socket is connected, send data using send()
                  window.ws.send(JSON.stringify([HELLO, "realm", {}]));
               };

               window.ws.onmessage = function (evt)
               {
                  var received_msg = evt.data;
                  console.log(received_msg)
                  li = document.createElement('li');
                  li.innerHTML = received_msg;

                  ul = document.getElementsByTagName('ul')[0];
                  ul.appendChild(li);
               };

               window.ws.onclose = function()
               {
                  // websocket is closed.
                  alert("Connection is closed...");
               };
            }

            else
            {
               // The browser doesn't support WebSocket
               alert("WebSocket NOT supported by your Browser!");
            }
         }
         function subscribe() {
               rpc = document.getElementsByTagName('input')[0].value;
               window.ws.send(JSON.stringify([SUBSCRIBE, counter, {}, rpc]));
               counter++;
         }
         function publish() {
               rpc = document.getElementsByTagName('input')[1].value;
               args_value = document.getElementsByTagName('textarea')[0].value;
               kwargs_value = document.getElementsByTagName('textarea')[1].value;

               if (args_value)
                    args = JSON.parse(args_value);
               else
                    args = [];
               if (kwargs_value)
                    kwargs = JSON.parse(kwargs_value);
               else
                    kwargs = {};

               window.ws.send(JSON.stringify([PUBLISH, counter, {}, rpc, args, kwargs]));
               counter++;
         }
         document.addEventListener("DOMContentLoaded", function(event) {
            WebSocketTest()
         });
      </script>
   </head>
   <body>
       <div>
           <h4>Subscribe</h4>
           <div>
               <label>RPC</label>
               <input type="text" value="websocket_test.websocket_test"/>
           </div>
            <button onclick="subscribe()">Send</button>
       </div>
       <div>
           <h4>Publish</h4>
           <div>
               <label>RPC</label>
               <div><input type="text" value="websocket_test.hello_websocket"/></div>
           </div>
           <div>
               <label>Arguments</label>
               <div><textarea>["somebody"]</textarea></div>
           </div>
           <div>
               <label>Keyword Arguments</label>
               <div><textarea>{"name": "Nobody"}</textarea></div>
           </div>
           <button onclick="publish()">Send</button>
       </div>
       <ul>
       </ul>
   </body>
</html>